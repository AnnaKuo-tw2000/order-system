import{E as X}from"./input.5233a104.js";import{E as Y}from"./progress.c29ff1b3.js";import{E as Z}from"./overlay.634e7ac5.js";import{E as ee}from"./button.0a9f82c1.js";import{E as le}from"./input-number.de728674.js";import{_ as te,G as oe,H as ne,r as g,A as se,f as b,h as o,p as u,j as n,u as i,k as x,l as a,I as ie,F as O,J as T,y as w,K as P,L as ae,M as ue,N as R,O as p,P as A,Q as z,m as k,n as de,D as re,E as ce,R as F,S as j}from"./entry.026a703f.js";import{u as pe}from"./auth.ed90e6d4.js";import{u as fe}from"./cart.15e2a50f.js";const U=V=>(re("data-v-59610793"),V=V(),ce(),V),me={class:"flex flex-wrap"},_e={class:"mb-8 ml-5 border-2 p-3 w-fit"},ve=U(()=>o("h2",{class:"text-lg font-bold"},"操作訂餐列表",-1)),ge={class:"flex gap-5"},he=U(()=>o("div",null,"圖片：",-1)),Ce=["src"],$e={class:"mb-8 ml-5 border-2 p-3 w-fit"},be=U(()=>o("h2",{class:"text-lg font-bold"},"訂餐列表",-1)),xe=["src"],we={class:"mb-8 ml-5 border-2 p-3 w-fit"},ke={class:"text-lg font-bold"},Ve=["src"],Ie=U(()=>o("span",null," 要登入才能存取購物車資料喔 ",-1)),Le={class:"dialog-footer"},ye={__name:"index",setup(V){const d=oe(),N=ne(),I=pe(),f=g(""),m=g(null),_=g([]);let s=null;const B=g(""),L=g(!1),G=e=>{B.value=e.url,L.value=!0};function H(){const e=_.value[0].raw;if(e){const l=P(N,`food-images/${e.name}`);ae(l,e,{contentType:e.type}).then(()=>{ue(l).then(r=>{const c=(s==null?void 0:s.uid)||Date.now();R(p(d,`foodInfo/${c}`),{title:f.value,price:m.value,imageUrl:r,imageName:e.name,uid:c}).then(()=>{y()}).then(()=>{s&&(F(P(N,`food-images/${s.imageName}`)),s=null)}),f.value="",m.value=null,_.value=[]})})}else A(p(d,`foodInfo/${s==null?void 0:s.uid}`),{title:f.value,price:m.value}).then(()=>{y()}),f.value="",m.value=null,_.value=[],s=null}function J(e){j(p(d,`foodInfo/${e.uid}`)).then(()=>{y(),z(p(d,"userInfo")).then(l=>{if(l.exists())for(const[r,c]of Object.entries(l.val()))Object.values(c.shoppingCart).forEach(C=>{C.uid===e.uid&&j(p(d,`userInfo/${r}/shoppingCart/${C.uid}`))})}).then(()=>{F(P(N,`food-images/${e.imageName}`))})})}function K(e){s=e,f.value=e.title,m.value=e.price,_.value=[{name:e.imageName,url:e.imageUrl}]}const D=g([]);function y(){z(p(d,"foodInfo")).then(e=>{if(e.exists()){const l=e.val();D.value=Object.values(l)}else D.value=null})}y();const S=fe(),h=g(!1);function M(e){var l;if((l=I.userInfo)!=null&&l.uid){let r=1;if(S.cartList){const c=S.cartList.find(E=>E.uid===e.uid);c&&(r=c.num+1)}R(p(d,`userInfo/${I.userInfo.uid}/shoppingCart/${e.uid}`),{...e,num:r})}else h.value=!0}function Q(e,l){A(p(d,`userInfo/${I.userInfo.uid}/shoppingCart/${l.uid}`),{num:e})}function q(e){j(p(d,`userInfo/${I.userInfo.uid}/shoppingCart/${e.uid}`))}return(e,l)=>{const r=X,c=se("font-awesome-icon"),E=Y,C=Z,v=ee,W=le;return k(),b("div",me,[o("section",_e,[ve,o("div",ge,[o("div",null,[o("div",null,[u("標題："),n(r,{modelValue:i(f),"onUpdate:modelValue":l[0]||(l[0]=t=>x(f)?f.value=t:null),placeholder:"Please input"},null,8,["modelValue"])]),o("div",null,[u("價格："),n(r,{modelValue:i(m),"onUpdate:modelValue":l[1]||(l[1]=t=>x(m)?m.value=t:null),placeholder:"Please input"},null,8,["modelValue"])])]),o("div",null,[he,n(E,{"file-list":i(_),"onUpdate:fileList":l[2]||(l[2]=t=>x(_)?_.value=t:null),action:"#","list-type":"picture-card","on-preview":G,"auto-upload":!1,class:ie({hide:i(_).length>0})},{default:a(()=>[n(c,{icon:["fas","plus"]})]),_:1},8,["file-list","class"])])]),n(C,{modelValue:i(L),"onUpdate:modelValue":l[3]||(l[3]=t=>x(L)?L.value=t:null)},{default:a(()=>[o("img",{"w-full":"",src:i(B),alt:"Preview Image"},null,8,Ce)]),_:1},8,["modelValue"]),n(v,{onClick:H},{default:a(()=>[u("上傳並新增")]),_:1})]),o("section",$e,[be,(k(!0),b(O,null,T(i(D),t=>(k(),b("div",{key:t.uid,class:"mb-3"},[o("img",{src:t.imageUrl,alt:"",style:{width:"50px",height:"50px"}},null,8,xe),o("div",null,"品項："+w(t.title),1),o("div",null,"價格："+w(t.price),1),n(v,{onClick:$=>M(t)},{default:a(()=>[u("加入購物車")]),_:2},1032,["onClick"]),n(v,{onClick:$=>K(t)},{default:a(()=>[u("編輯項目")]),_:2},1032,["onClick"]),n(v,{onClick:$=>J(t)},{default:a(()=>[u("刪除項目")]),_:2},1032,["onClick"])]))),128))]),o("section",we,[o("h2",ke,"購物車(總價："+w(i(S).cartSum)+")",1),(k(!0),b(O,null,T(i(S).cartList,t=>(k(),b("div",{key:t.uid,class:"mb-3"},[o("img",{src:t.imageUrl,alt:"",style:{width:"50px",height:"50px"}},null,8,Ve),o("div",null,"品項："+w(t.title),1),o("div",null,"價格："+w(t.price),1),o("div",null,[u("數量："),n(W,{"model-value":t.num,min:1,size:"small",onChange:$=>Q($,t)},null,8,["model-value","onChange"])]),n(v,{onClick:$=>q(t)},{default:a(()=>[u("刪除品項")]),_:2},1032,["onClick"])]))),128)),n(C,{modelValue:i(h),"onUpdate:modelValue":l[6]||(l[6]=t=>x(h)?h.value=t:null),title:"請登入",width:"40%"},{footer:a(()=>[o("span",Le,[n(v,{onClick:l[4]||(l[4]=t=>h.value=!1)},{default:a(()=>[u("取消")]),_:1}),n(v,{type:"primary",onClick:l[5]||(l[5]=t=>("navigateTo"in e?e.navigateTo:i(de))("/example/auth/login"))},{default:a(()=>[u(" 登入 ")]),_:1})])]),default:a(()=>[Ie]),_:1},8,["modelValue"])])])}}},Oe=te(ye,[["__scopeId","data-v-59610793"]]);export{Oe as default};
