import{E as X}from"./input.8247a8fb.js";import{E as Y}from"./progress.b4f955ac.js";import{E as Z}from"./overlay.207610d6.js";import{E as ee}from"./button.d46e449a.js";import{E as le}from"./input-number.62f36390.js";import{_ as te,G as oe,H as ne,r as g,A as se,f as $,h as o,p as d,j as n,u as i,k as x,l as u,I as ae,F as O,J as T,y as w,K as P,L as ie,M as ue,N as R,O as p,P as A,Q as z,m as k,n as de,D as re,E as ce,R as F,S as j}from"./entry.7c31a8c4.js";import{u as pe}from"./auth.57b5a3b8.js";import{u as fe}from"./cart.8a1a5f3a.js";const U=V=>(re("data-v-ce507dcb"),V=V(),ce(),V),me={class:"flex flex-wrap"},_e={class:"mb-8 ml-5 border-2 p-3 w-fit"},ve=U(()=>o("h2",{class:"text-lg font-bold"},"操作訂餐列表",-1)),ge={class:"flex gap-5"},he=U(()=>o("div",null,"圖片：",-1)),Ce=["src"],be={class:"mb-8 ml-5 border-2 p-3 w-fit"},$e=U(()=>o("h2",{class:"text-lg font-bold"},"訂餐列表",-1)),xe=["src"],we={class:"mb-8 ml-5 border-2 p-3 w-fit"},ke={class:"text-lg font-bold"},Ve=["src"],Ie=U(()=>o("span",null," 要登入才能存取購物車資料喔 ",-1)),Le={class:"dialog-footer"},ye={__name:"index",setup(V){const r=oe(),N=ne(),I=pe(),f=g(""),m=g(null),_=g([]);let s=null;const B=g(""),L=g(!1),G=e=>{B.value=e.url,L.value=!0};function H(){const e=_.value[0].raw;if(e){const l=P(N,`food-images/${e.name}`);ie(l,e,{contentType:e.type}).then(()=>{ue(l).then(a=>{const c=(s==null?void 0:s.uid)||Date.now();R(p(r,`foodInfo/${c}`),{title:f.value,price:m.value,imageUrl:a,imageName:e.name,uid:c}).then(()=>{y()}).then(()=>{s&&(F(P(N,`food-images/${s.imageName}`)),s=null)}),f.value="",m.value=null,_.value=[]}).catch(a=>{alert(a)})})}else A(p(r,`foodInfo/${s==null?void 0:s.uid}`),{title:f.value,price:m.value}).then(()=>{y()}),f.value="",m.value=null,_.value=[],s=null}function J(e){j(p(r,`foodInfo/${e.uid}`)).then(()=>{y(),z(p(r,"userInfo")).then(l=>{if(l.exists())for(const[a,c]of Object.entries(l.val()))Object.values(c.shoppingCart).forEach(C=>{C.uid===e.uid&&j(p(r,`userInfo/${a}/shoppingCart/${C.uid}`))});else console.log("no data")}).then(()=>{F(P(N,`food-images/${e.imageName}`))})})}function K(e){s=e,f.value=e.title,m.value=e.price,_.value=[{name:e.imageName,url:e.imageUrl}]}const D=g([]);function y(){z(p(r,"foodInfo")).then(e=>{if(e.exists()){const l=e.val();D.value=Object.values(l)}else D.value=null,console.log("no data")})}y();const S=fe(),h=g(!1);function M(e){var l;if((l=I.userInfo)!=null&&l.uid){let a=1;if(S.cartList){const c=S.cartList.find(E=>E.uid===e.uid);c&&(a=c.num+1)}R(p(r,`userInfo/${I.userInfo.uid}/shoppingCart/${e.uid}`),{...e,num:a})}else h.value=!0}function Q(e,l){A(p(r,`userInfo/${I.userInfo.uid}/shoppingCart/${l.uid}`),{num:e})}function q(e){j(p(r,`userInfo/${I.userInfo.uid}/shoppingCart/${e.uid}`))}return(e,l)=>{const a=X,c=se("font-awesome-icon"),E=Y,C=Z,v=ee,W=le;return k(),$("div",me,[o("section",_e,[ve,o("div",ge,[o("div",null,[o("div",null,[d("標題："),n(a,{modelValue:i(f),"onUpdate:modelValue":l[0]||(l[0]=t=>x(f)?f.value=t:null),placeholder:"Please input"},null,8,["modelValue"])]),o("div",null,[d("價格："),n(a,{modelValue:i(m),"onUpdate:modelValue":l[1]||(l[1]=t=>x(m)?m.value=t:null),placeholder:"Please input"},null,8,["modelValue"])])]),o("div",null,[he,n(E,{"file-list":i(_),"onUpdate:fileList":l[2]||(l[2]=t=>x(_)?_.value=t:null),action:"#","list-type":"picture-card","on-preview":G,"auto-upload":!1,class:ae({hide:i(_).length>0})},{default:u(()=>[n(c,{icon:["fas","plus"]})]),_:1},8,["file-list","class"])])]),n(C,{modelValue:i(L),"onUpdate:modelValue":l[3]||(l[3]=t=>x(L)?L.value=t:null)},{default:u(()=>[o("img",{"w-full":"",src:i(B),alt:"Preview Image"},null,8,Ce)]),_:1},8,["modelValue"]),n(v,{onClick:H},{default:u(()=>[d("上傳並新增")]),_:1})]),o("section",be,[$e,(k(!0),$(O,null,T(i(D),t=>(k(),$("div",{key:t.uid,class:"mb-3"},[o("img",{src:t.imageUrl,alt:"",style:{width:"50px",height:"50px"}},null,8,xe),o("div",null,"品項："+w(t.title),1),o("div",null,"價格："+w(t.price),1),n(v,{onClick:b=>M(t)},{default:u(()=>[d("加入購物車")]),_:2},1032,["onClick"]),n(v,{onClick:b=>K(t)},{default:u(()=>[d("編輯項目")]),_:2},1032,["onClick"]),n(v,{onClick:b=>J(t)},{default:u(()=>[d("刪除項目")]),_:2},1032,["onClick"])]))),128))]),o("section",we,[o("h2",ke,"購物車(總價："+w(i(S).cartSum)+")",1),(k(!0),$(O,null,T(i(S).cartList,t=>(k(),$("div",{key:t.uid,class:"mb-3"},[o("img",{src:t.imageUrl,alt:"",style:{width:"50px",height:"50px"}},null,8,Ve),o("div",null,"品項："+w(t.title),1),o("div",null,"價格："+w(t.price),1),o("div",null,[d("數量："),n(W,{"model-value":t.num,min:1,size:"small",onChange:b=>Q(b,t)},null,8,["model-value","onChange"])]),n(v,{onClick:b=>q(t)},{default:u(()=>[d("刪除品項")]),_:2},1032,["onClick"])]))),128)),n(C,{modelValue:i(h),"onUpdate:modelValue":l[6]||(l[6]=t=>x(h)?h.value=t:null),title:"請登入",width:"40%"},{footer:u(()=>[o("span",Le,[n(v,{onClick:l[4]||(l[4]=t=>h.value=!1)},{default:u(()=>[d("取消")]),_:1}),n(v,{type:"primary",onClick:l[5]||(l[5]=t=>("navigateTo"in e?e.navigateTo:i(de))("/example/auth/login"))},{default:u(()=>[d(" 登入 ")]),_:1})])]),default:u(()=>[Ie]),_:1},8,["modelValue"])])])}}},Oe=te(ye,[["__scopeId","data-v-ce507dcb"]]);export{Oe as default};
